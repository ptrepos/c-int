#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <magica/int.h>

#include "mg_assert.h"

static void div_test(const char *text1, const char *text2, const char *ret1, const char *ret2)
{
	char strbuf1[1024];
	char strbuf2[1024];
	mg_uint128 v1, v2, v3, v4;

	mg_uint128_test_convert(text1, &v1);
	mg_uint128_test_convert(text2, &v2);

	mg_uint128_div(&v1, &v2, &v3, &v4);

	mg_uint128_test_to_string(&v4, strbuf1);
	mg_uint128_test_to_string(&v3, strbuf2);

	mg_assert(strcmp(ret1, strbuf2) == 0);
	mg_assert(strcmp(ret2, strbuf1) == 0);

	mg_uint128_div_long_division(&v1, &v2, &v3, &v4);

	mg_uint128_test_to_string(&v4, strbuf1);
	mg_uint128_test_to_string(&v3, strbuf2);

	mg_assert(strcmp(ret1, strbuf2) == 0);
	mg_assert(strcmp(ret2, strbuf1) == 0);

	mg_uint128_div_srt(&v1, &v2, &v3, &v4);

	mg_uint128_test_to_string(&v4, strbuf1);
	mg_uint128_test_to_string(&v3, strbuf2);

	mg_assert(strcmp(ret1, strbuf2) == 0);
	mg_assert(strcmp(ret2, strbuf1) == 0);

	mg_uint128_div_maclaurin(&v1, &v2, &v3, &v4);

	mg_uint128_test_to_string(&v4, strbuf1);
	mg_uint128_test_to_string(&v3, strbuf2);

	mg_assert(strcmp(ret1, strbuf2) == 0);
	mg_assert(strcmp(ret2, strbuf1) == 0);
}

static void div_mul_test(const char *text1, const char *text2)
{
	char strbuf[1024];
	mg_uint128 v1, v2, v3, v4, v5;

	mg_uint128_test_convert(text1, &v1);
	mg_uint128_test_convert(text2, &v2);

	mg_uint128_div(&v1, &v2, &v3, &v4);

	int overflow = mg_uint128_mul(&v2, &v3, &v5);
	mg_assert(overflow == 0);
	mg_uint128_add(&v5, &v4, &v1);

	mg_uint128_test_to_string(&v1, strbuf);

	mg_assert(strcmp(text1, strbuf) == 0);
}

void mg_uint128_div_test()
{
	div_test("9", "2", "4", "1");
	div_test("1", "1", "1", "0");
	div_test("0", "10000000000000000000000999", "0", "0");
	div_test("0", "512634", "0", "0");
	div_test("0", "6576827984654135115641", "0", "0");
	div_test("1", "1", "1", "0");
	div_test("4952", "330", "15", "2");
	div_test("90000001", "852", "105633", "685");
	div_test("852", "3", "284", "0");
	div_test("852", "2", "426", "0");
	div_test("852", "64", "13", "20");
	div_test("852", "999", "0", "852");
	div_test("530000", "270", "1962", "260");
	div_test("986500", "999", "987", "487");
	div_test("5968", "2", "2984", "0");
	div_test("9996550", "355", "28159", "105");
	div_test("7800", "100", "78", "0");
	div_test("7800", "320", "24", "120");
	div_test("7800", "8", "975", "0");
	div_test("7800", "96", "81", "24");
	div_test("33076", "33076", "1", "0");
	div_test("33076", "365", "90", "226");
	div_test("33076001551", "365", "90619182", "121");
	div_test("340282366920938463463374607431768211455", "340282366920938463463374607431768211455", "1", "0");
	div_test("340282366920938463463374607431768211455", "34028236692093846346337460743176821", "10000", "1455");
	div_test("340282366920938463463374607431768211455", "34028236692093846346337460743", "10000000000", "1768211455");
	div_test("340282366920938463463374607431768211455", "340282366920938463463374", "1000000000000000", "607431768211455");
	div_test("340282366920938463463374607431768211455", "34028236692093846", "10000000000000000101779", "14705147148659421");
	div_test("340282366920938463463374607431768211455", "34028236692", "10000000000027578962491325303", "24515593779");
	div_test("340282366920938463463374607431768211455", "34028", "10000069558038628878082009152220765", "20035");
	div_test("340282366920938463463374607431768211455", "1", "340282366920938463463374607431768211455", "0");
	div_test("115455541278518826348508491156672682", "115455541278518826348508491156672682", "1", "0");
	div_test("115455541278518826348508491156672682", "11545554127851882634850849115", "10000000", "6672682");
	div_test("115455541278518826348508491156672682", "1154555412785188263485", "100000000000000", "8491156672682");
	div_test("115455541278518826348508491156672682", "115455541278518", "1000000000000007157287", "63820456412016");
	div_test("115455541278518826348508491156672682", "1154555", "100000035752752208728478497045", "882707");
	div_test("115455541278518826348508491156672682", "1", "115455541278518826348508491156672682", "0");
	div_test("340282366920938463463374607431768211455", "340282366920938463463374607431768211455", "1", "0");
	div_test("340282366920938463463374607431768", "340282366920938463463374607431768211455", "0", "340282366920938463463374607431768");
	div_test("340282366920938463463374607", "340282366920938463463374607431768211455", "0", "340282366920938463463374607");
	div_test("34028236692093846346", "340282366920938463463374607431768211455", "0", "34028236692093846346");
	div_test("340282366920938", "340282366920938463463374607431768211455", "0", "340282366920938");
	div_test("340282366", "340282366920938463463374607431768211455", "0", "340282366");
	div_test("3402", "340282366920938463463374607431768211455", "0", "3402");
	div_test("1", "340282366920938463463374607431768211455", "0", "1");
	div_test("1154555412785188263472682", "1154555412785188263485084", "0", "1154555412785188263472682");
	div_test("1154555412", "11545554127851882634850849115", "0", "1154555412");
	div_test("11545554127851882634850849115", "1154555", "10000003575275220872847", "981030");
	div_test("11545554127851882634850849115", "115455541278518", "100000000000000", "82634850849115");
	div_test("99999999999999999999999999999999999", "99999999999999999999999999999999999", "1", "0");
	div_test("99999999999999999999999999999999999", "9999999999999999999999999999", "10000000", "9999999");
	div_test("99999999999999999999999999999999999", "99999999999999999999", "1000000000000000", "999999999999999");
	div_test("99999999999999999999999999999999999", "99999999999", "1000000000010000000000100", "99");
	div_test("99999999999999999999999999999999999", "9999", "10001000100010001000100010001000", "999");

	div_mul_test("5468716165", "6576141");
	div_mul_test("10000000", "3");
	div_mul_test("89", "3");
	div_mul_test("5667265745641563720546074880560485452", "4545612101");
	div_mul_test("566726574564156372", "6054987415246054607488056048544890489");
	div_mul_test("5667265745641563726054987415246054607", "6054956048544890489");
	div_mul_test("888888", "2");
	div_mul_test("999999", "2");
	div_mul_test("999999999999", "2");
	div_mul_test("99999999999999999999999999", "2");
	div_mul_test("78456513564212", "9462");
	div_mul_test("1", "1");
	div_mul_test("1", "2");
	div_mul_test("1", "3");
	div_mul_test("10", "3");
	div_mul_test("10", "2");
	div_mul_test("1237894111111", "340282366920938463463374607431768211455");
	div_mul_test("100000000000000000000000000", "2");
	div_mul_test("100000000000000000000000000", "9");
	div_mul_test("100000000000000000000000000", "35412636");
	div_mul_test("100000000000000000000000000", "3402823669209384635");
	div_mul_test("97456415132141", "97456415132141");
	div_mul_test("9999999999999999480948984", "97456415132141");
	div_mul_test("415146", "304");
	div_mul_test("100000000000000000000000000000000", "10000000000000000000000000000000");
	div_mul_test("100000000000000000000000000000000", "10000000000000000000000000000");
	div_mul_test("100000000000000000000000000000000", "100000000000000000000000");
	div_mul_test("100000000000000000000000000000000", "1000000000000000000");
	div_mul_test("100000000000000000000000000000000", "1000000000000");
	div_mul_test("100000000000000000000000000000000", "1000000");
	div_mul_test("100000000000000000000000000000000", "10");
	div_mul_test("10000000000000000000000000000", "100000000000000000000000000000000");
	div_mul_test("100000000000000000000000", "100000000000000000000000000000000");
	div_mul_test("1000000000000000000", "100000000000000000000000000000000");
	div_mul_test("1000000000000", "100000000000000000000000000000000");
	div_mul_test("1000000", "100000000000000000000000000000000");
	div_mul_test("100000000000000000000000000", "100000000000000000000000000");
	div_mul_test("100000000000000000000000000", "10000000000000000000000");
	div_mul_test("100000000000000000000000000", "100000000000000000");
	div_mul_test("100000000000000000000000000", "100000000000000");
	div_mul_test("100000000000000000000000000", "1000000000000");
	div_mul_test("100000000000000000000000000", "1000000");
	div_mul_test("100000000000000000000000000", "10");
	div_mul_test("100000000000000000000000000", "100000000000000000000000000");
	div_mul_test("10000000000000000000000", "100000000000000000000000000");
	div_mul_test("100000000000000000", "100000000000000000000000000");
	div_mul_test("100000000000000", "100000000000000000000000000");
	div_mul_test("1000000000000", "100000000000000000000000000");
	div_mul_test("1000000", "100000000000000000000000000");
	div_mul_test("10", "100000000000000000000000000");
	div_mul_test("10000000000000000000000", "10000000000000000000000");
	div_mul_test("10000000000000000000000", "100000000000000000");
	div_mul_test("10000000000000000000000", "100000000000000");
	div_mul_test("10000000000000000000000", "1000000000000");
	div_mul_test("10000000000000000000000", "1000000");
	div_mul_test("10000000000000000000000", "10");
	div_mul_test("10000000000000000000000", "10000000000000000000000");
	div_mul_test("100000000000000000", "10000000000000000000000");
	div_mul_test("100000000000000", "10000000000000000000000");
	div_mul_test("1000000000000", "10000000000000000000000");
	div_mul_test("1000000", "10000000000000000000000");
	div_mul_test("10", "10000000000000000000000");
	div_mul_test("100000000000000000", "100000000000000000");
	div_mul_test("100000000000000000", "100000000000000");
	div_mul_test("100000000000000000", "1000000000000");
	div_mul_test("100000000000000000", "1000000");
	div_mul_test("100000000000000000", "10");
	div_mul_test("100000000000000000", "100000000000000000");
	div_mul_test("1000000000000", "100000000000000000");
	div_mul_test("1000000", "100000000000000000");
	div_mul_test("10", "100000000000000000");
	div_mul_test("10000000000000", "10000000000000");
	div_mul_test("10000000000000", "1000000");
	div_mul_test("10000000000000", "10");
	div_mul_test("10000000000000", "10000000000000");
	div_mul_test("1000000", "10000000000000");
	div_mul_test("10", "10000000000000");
	div_mul_test("10000000", "10000000");
	div_mul_test("10000000", "10000");
	div_mul_test("10000000", "10");
	div_mul_test("10000000", "10000000");
	div_mul_test("10000", "10000000");
	div_mul_test("10", "10000000");
	div_mul_test("10000000", "10000000");
	div_mul_test("10000000", "10000");
	div_mul_test("10000000", "10");
	div_mul_test("10000000", "10000000");
	div_mul_test("10000", "10000000");
	div_mul_test("10", "10000000");

	printf("TEST mg_uint128_div(): OK\n");
}
